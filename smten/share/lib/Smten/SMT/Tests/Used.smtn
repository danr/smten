
module Smten.SMT.Tests.Used (tests) where

import Smten.SMT.Symbolic
import Smten.Tests.Test

qtest :: SMT ()
qtest = do
    nest $ do
        xref <- use $ free
        use $ used xref >>= assert
        rx <- query $ used xref
        test "used.simple" (rx == Just True)

        use $ used xref >>= (assert . not)
        rx2 <- query $ used xref
        test "used.reuse" (rx2 == Nothing)

    nest $ do
        xref <- use $ free
        use $ do
            v1 <- used xref
            assert v1
            v2 <- used xref
            assert (not v2)
        rx <- query (return ())
        test "used.dupref" (rx == Nothing)

    nest $ do
        xref <- use $ do
           x <- free
           assert (not x)
           return x
        yref <- use free
        r <- query $ do
            vx <- used xref
            vy <- used yref
            assert (vx || vy)
            return vy
        test "used.join" (r == Just True)
        
tests :: IO ()
tests = do
    runSMT Yices1 qtest
    runSMT Yices2 qtest
    runSMT STP qtest

