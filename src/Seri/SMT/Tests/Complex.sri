
module Seri.SMT.Tests.Complex where {

import Seri.Lib.Prelude;
import Seri.SMT.SMT;

data Foo = Bar Integer
         | Sludge Bool;

defoo :: Foo -> Integer;
defoo (Bar x) = x;
defoo (Sludge b) = if b then 1 else 0;

foo :: Integer -> Integer;
foo x = x + 1;

scopedfail :: Query (Answer Integer);
scopedfail = do {
    x <- free;
    assert(x < x);
    query x;
};

tupfun :: (Integer, Bool) -> (Bool, Bool);
tupfun (i, b) = (i < 2, not b);

main :: Query (Answer (Bool, Integer, Bool, Foo));
main = do {
    b <- free;
    assert b;

    x <- free;
    assert ((if x < 0 then x else foo x) == 4);

    q <- queryS scopedfail;
    sf <- case q of {
            Satisfiable _ -> return True;
            _ -> return False;
          };

    f <- free;
    assert (2 == defoo f);


    t1 <- free;
    assert (fst (tupfun t1));

    query (b, x, sf, f);
}

}

