# vim: ft=python

Import('env')

env['SRCDIR'] = Dir(".")
env['GHCPATH'] = [Dir(".")]
#env['GHCFLAGS'] = "-ddump-splices"

## tests test
tests = env.GHCProgram('tests')
env.Default(env.Command('tests.out', tests, "$SOURCE > $TARGET"))

## haskell back end tests.
hstest = env.GHCProgram('hstest', 'Seri/Target/Haskell/tests.hs')
hstest_src = env.Command('hstest_hs.hs', hstest, '$SOURCE $TARGET')
hstest_exe = env.GHCProgram('hstest_exe', hstest_src)
env.Default(env.Command('hstest_exe.out', hstest_exe, "$SOURCE > $TARGET"))

## C back end tests.
ctest = env.GHCProgram('ctest', 'Seri/Target/C/tests.hs')
ctest_src = env.Command('ctest_c.c', ctest, '$SOURCE $TARGET')
ctest_exe = env.Program('ctest_exe', ctest_src)
#env.Default(env.Command('ctest_exe.out', ctest_exe, "$SOURCE > $TARGET"))

## SMT run query
runquery = env.GHCProgram('runquery', 'Seri/SMT/runquery.hs')
env.Default(runquery)
query1 = env.Command('query1.out', [runquery, 'Seri/SMT/query1.sri'],
    '$SOURCE < ${SOURCES[1]} > $TARGET')
env.Default(query1)

